[gd_scene load_steps=12 format=3 uid="uid://cvm0gj3ingxrw"]

[ext_resource type="Texture2D" uid="uid://b8jik37dylaiv" path="res://Letter_Asset/a.png" id="2_y0u1e"]
[ext_resource type="Texture2D" uid="uid://bnx04qsfppta1" path="res://Letter_Asset/b.png" id="3_4u7ax"]
[ext_resource type="Texture2D" uid="uid://bpok2ufrbr0ba" path="res://Letter_Asset/c.png" id="4_ppqxg"]
[ext_resource type="Texture2D" uid="uid://1sj2fr4chs74" path="res://Letter_Asset/d.png" id="5_xh1g2"]
[ext_resource type="Texture2D" uid="uid://bw2lw0dugsaru" path="res://Letter_Asset/e.png" id="6_dc58s"]
[ext_resource type="Texture2D" uid="uid://llwxte3v2mkr" path="res://Letter_Asset/f.png" id="7_4i4y2"]
[ext_resource type="Texture2D" uid="uid://cwt5pe7dnpux8" path="res://Letter_Asset/g.png" id="8_7mtbg"]
[ext_resource type="Texture2D" uid="uid://c2ku70jpntr2h" path="res://Letter_Asset/h.png" id="9_w7nnp"]
[ext_resource type="Texture2D" uid="uid://cy53s0c3a3cdi" path="res://Letter_Asset/i.png" id="10_fp13h"]

[sub_resource type="GDScript" id="GDScript_j65t2"]
script/source = "extends Area2D

var tiles = []
var solved = []
var mouse = false
var xc = 300 + 61
var yc = 300 + 39
# Called when the node enters the scene tree for the first time.
func _ready():
	start_game()

func start_game():
	tiles = [$Tile1, $Tile2, $Tile3, $Tile4, $Tile5, $Tile6, $Tile7, $Tile8, $Tile9]
	solved = tiles.duplicate()
	shuffle_tiles()
# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	if Input.is_mouse_button_pressed(MOUSE_BUTTON_LEFT) and mouse:
		var mouse_copy = mouse.duplicate()
		#print(mouse.position)
		mouse = false
		var rows = int(mouse_copy.position.y/yc)
		var cols = int(mouse_copy.position.x/xc)
		print(rows, \", \", cols)
		
		# Uncertain what the following means
		var pos= rows * 3 + cols
		print(tiles[pos])
		check_neighbors(rows, cols)
		if tiles == solved:
			print(\"Congrats!!\")
			
func shuffle_tiles():
	var previous = 99
	var previous1 = 98
	for i in range(0, 1000):
		var tile = randi() % 9
		if tiles[tile] != $Tile9 and tile != previous and tile != previous1:
			var rows = int(tiles[tile].position.y / yc)
			var cols = int(tiles[tile].position.x / xc)
			check_neighbors(rows,cols)
			previous1 = previous
			previous = tile
		
		
func check_neighbors(rows, cols):
	var empty = false
	var done = false
	var pos = rows * 3 + cols
	while !empty and !done:
		var new_pos = tiles[pos].position
		
		# Vertical position swap
		if rows < 2:
			new_pos.y += yc
			empty = find_empty(new_pos, pos)
			new_pos.y -= yc
		if rows > 0:
			new_pos.y -= yc
			empty = find_empty(new_pos, pos)
			new_pos.y += yc
			
		# Horizontal position swap
		if cols < 2:
			new_pos.x += xc
			empty = find_empty(new_pos, pos)
			new_pos.x -= xc
		if cols > 0:
			new_pos.x -= xc
			empty = find_empty(new_pos, pos)
			new_pos.x += xc
		
		done = true
			
# Finding the empty position in between two tiles
func find_empty(posit, pos):
	var new_rows = int(posit.y/yc)
	var new_cols = int(posit.x/xc)
	var new_pos = new_rows * 3 + new_cols
	
	if tiles[new_pos] == $Tile9:
		swap_tiles(pos, new_pos)
		return true
	return false

#Algorithm for the actual switching of tiles
func swap_tiles(tile_src, tile_dst):
	var temp_pos = tiles[tile_src].position
	tiles[tile_src].position = tiles[tile_dst].position
	tiles[tile_dst].position = temp_pos

	var temp_tile = tiles[tile_src]
	tiles[tile_src] = tiles[tile_dst]
	tiles[tile_dst] = temp_tile
	
# Takes in event input... need better explanation
func _input_event(viewport, event, shape_idx):
	if event is InputEventMouseButton:
		mouse = event
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_lhlsq"]
size = Vector2(900, 900)

[node name="PuzzleShift" type="Area2D"]
script = SubResource("GDScript_j65t2")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(453, 447)
shape = SubResource("RectangleShape2D_lhlsq")
one_way_collision_margin = 0.0

[node name="Tile1" type="Sprite2D" parent="."]
visible = false
position = Vector2(150, 150)
texture = ExtResource("2_y0u1e")

[node name="Tile2" type="Sprite2D" parent="."]
visible = false
position = Vector2(450, 150)
scale = Vector2(3, 3)
texture = ExtResource("3_4u7ax")

[node name="Tile3" type="Sprite2D" parent="."]
visible = false
position = Vector2(750, 150)
scale = Vector2(3, 3)
texture = ExtResource("4_ppqxg")

[node name="Tile4" type="Sprite2D" parent="."]
visible = false
position = Vector2(150, 450)
scale = Vector2(3, 3)
texture = ExtResource("5_xh1g2")

[node name="Tile5" type="Sprite2D" parent="."]
visible = false
position = Vector2(450, 450)
scale = Vector2(3, 3)
texture = ExtResource("6_dc58s")

[node name="Tile6" type="Sprite2D" parent="."]
visible = false
position = Vector2(750, 450)
scale = Vector2(3, 3)
texture = ExtResource("7_4i4y2")

[node name="Tile7" type="Sprite2D" parent="."]
visible = false
position = Vector2(150, 750)
scale = Vector2(3, 3)
texture = ExtResource("8_7mtbg")

[node name="Tile8" type="Sprite2D" parent="."]
visible = false
position = Vector2(450, 750)
scale = Vector2(3, 3)
texture = ExtResource("9_w7nnp")

[node name="Tile9" type="Sprite2D" parent="."]
visible = false
position = Vector2(750, 750)
scale = Vector2(3, 3)
texture = ExtResource("10_fp13h")
